# Запуск роя дронов

Этот документ содержит инструкции по запуску роя из 5 дронов, которые летят из точки А в точку Б в различных формациях.

## Особенности роя дронов

Рой дронов имеет следующие возможности:
- Автоматическое построение в различные формации:
  - V-образная формация (как стая птиц)
  - Линейная формация (перпендикулярно направлению движения)
  - Круговая формация (вокруг центрального дрона)
- Координированное движение всех дронов
- Автоматическое перестроение формаций во время полета
- Визуализация целевых точек для каждого дрона

## Подготовка

1. Убедитесь, что все скрипты имеют права на выполнение:
   ```bash
   chmod +x scripts/drone_swarm_controller.py scripts/start_drone_swarm.sh
   ```

## Запуск роя дронов

### Вариант 1: Использование автоматического скрипта

Запустите скрипт, который автоматизирует весь процесс:
```bash
./scripts/start_drone_swarm.sh
```

Следуйте инструкциям в терминале. Скрипт будет последовательно:
1. Запускать Gazebo
2. Запрашивать добавление моделей дронов в Gazebo
3. Запускать 5 экземпляров SITL с разными ID
4. Запускать контроллер роя дронов

### Вариант 2: Ручной запуск

Если вы предпочитаете запускать все вручную, следуйте этим шагам:

#### Шаг 1: Запустите Gazebo
```bash
roslaunch gazebo_ros empty_world.launch
```

#### Шаг 2: Добавьте модели дронов в Gazebo
Добавьте 5 моделей дронов из `/home/timowko/ardupilot_gazebo/models/iris_with_ardupilot` в Gazebo.
Разместите их в форме сетки с расстоянием примерно 2-3 метра между ними.

#### Шаг 3: Запустите экземпляры SITL для каждого дрона
В отдельных терминалах запустите:

```bash
# Дрон 1
cd ~/ardupilot/ArduCopter
sim_vehicle.py -v ArduCopter -f gazebo-iris --sysid 1 --instance 0 --out=udp:127.0.0.1:14561 --out=udp:127.0.0.1:14550 --console
```

```bash
# Дрон 2
cd ~/ardupilot/ArduCopter
sim_vehicle.py -v ArduCopter -f gazebo-iris --sysid 2 --instance 1 --out=udp:127.0.0.1:14562 --out=udp:127.0.0.1:14550 --console
```

```bash
# Дрон 3
cd ~/ardupilot/ArduCopter
sim_vehicle.py -v ArduCopter -f gazebo-iris --sysid 3 --instance 2 --out=udp:127.0.0.1:14563 --out=udp:127.0.0.1:14550 --console
```

```bash
# Дрон 4
cd ~/ardupilot/ArduCopter
sim_vehicle.py -v ArduCopter -f gazebo-iris --sysid 4 --instance 3 --out=udp:127.0.0.1:14564 --out=udp:127.0.0.1:14550 --console
```

```bash
# Дрон 5
cd ~/ardupilot/ArduCopter
sim_vehicle.py -v ArduCopter -f gazebo-iris --sysid 5 --instance 4 --out=udp:127.0.0.1:14565 --out=udp:127.0.0.1:14550 --console
```

Дождитесь полной инициализации каждого экземпляра ArduCopter перед запуском следующего.

#### Шаг 4: Запустите контроллер роя дронов
```bash
roslaunch basic_nav drone_swarm.launch
```

## Наблюдение за роем

После запуска контроллера роя:

1. Наблюдайте за перемещением дронов в Gazebo
2. Дроны автоматически взлетят и начнут выполнять миссию роя
3. Рой будет перемещаться в различных формациях:
   - V-образная формация (как стая птиц)
   - Линейная формация (перпендикулярно направлению движения)
   - Круговая формация (вокруг центрального дрона)

## Подключение через QGC

Вы также можете подключиться к дронам через QGroundControl:

1. Запустите QGC на вашем компьютере
2. В QGC настройте подключение по UDP к порту 14550
3. QGC должен автоматически обнаружить все 5 дронов
4. Вы сможете наблюдать за состоянием дронов и их параметрами
5. Переключаться между дронами можно через Vehicle список

## Настройка

Вы можете изменить параметры роя, отредактировав параметры в launch-файле:
```bash
roslaunch basic_nav drone_swarm.launch num_drones:=3 takeoff_altitude:=3.0 formation_distance:=3.0
```

Параметры:
- `num_drones` - количество дронов в рое (по умолчанию 5)
- `takeoff_altitude` - высота взлета в метрах (по умолчанию 2.0)
- `formation_distance` - расстояние между дронами в формации в метрах (по умолчанию 2.0)

## Устранение неполадок

1. **Проблемы с инициализацией дронов**:
   - Убедитесь, что все экземпляры SITL успешно инициализированы
   - Проверьте, что модели дронов в Gazebo правильно соответствуют экземплярам SITL

2. **Дроны не армируются или не взлетают**:
   - Проверьте логи контроллера роя для выявления проблем
   - Убедитесь, что дроны находятся в режиме "GUIDED"

3. **Проблемы с формациями**:
   - Если дроны не могут построиться в формацию, увеличьте параметр `formation_distance`
   - Проверьте, что начальное расположение дронов в Gazebo не слишком близкое

4. **Столкновения дронов**:
   - Увеличьте параметр `formation_distance`
   - Убедитесь, что начальное расположение дронов достаточно разреженное 