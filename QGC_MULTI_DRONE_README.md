# Запуск нескольких дронов с управлением через QGC

Этот документ содержит инструкции по запуску 5 дронов в симуляции с возможностью управления через QGroundControl (QGC).

## Подготовка

1. Убедитесь, что у вас установлен QGroundControl на вашем компьютере
2. Убедитесь, что все скрипты имеют права на выполнение:
   ```bash
   chmod +x scripts/start_multi_drone_qgc.sh
   ```

## Запуск симуляции

Вы можете запустить симуляцию двумя способами:

### Вариант 1: Использование автоматического скрипта

Запустите скрипт, который автоматизирует весь процесс:
```bash
./scripts/start_multi_drone_qgc.sh
```

Следуйте инструкциям в терминале. Скрипт будет последовательно:
1. Запускать Gazebo
2. Запрашивать добавление моделей дронов в Gazebo
3. Запускать 5 экземпляров SITL с разными ID
4. Запускать MAVROS для подключения к QGC

### Вариант 2: Ручной запуск

Если вы предпочитаете запускать все вручную, следуйте этим шагам:

#### Шаг 1: Запустите Gazebo
```bash
roslaunch gazebo_ros empty_world.launch
```

#### Шаг 2: Добавьте модели дронов в Gazebo
Добавьте 5 моделей дронов из `/home/timowko/ardupilot_gazebo/models/iris_with_ardupilot` в Gazebo.
Разместите их на некотором расстоянии друг от друга, чтобы избежать столкновений.

#### Шаг 3: Запустите экземпляры SITL для каждого дрона
В отдельных терминалах запустите:

```bash
# Дрон 1
cd ~/ardupilot/ArduCopter
sim_vehicle.py -v ArduCopter -f gazebo-iris --sysid 1 --instance 0 --out=udp:127.0.0.1:14561 --out=udp:127.0.0.1:14550 --console
```

```bash
# Дрон 2
cd ~/ardupilot/ArduCopter
sim_vehicle.py -v ArduCopter -f gazebo-iris --sysid 2 --instance 1 --out=udp:127.0.0.1:14562 --out=udp:127.0.0.1:14550 --console
```

```bash
# Дрон 3
cd ~/ardupilot/ArduCopter
sim_vehicle.py -v ArduCopter -f gazebo-iris --sysid 3 --instance 2 --out=udp:127.0.0.1:14563 --out=udp:127.0.0.1:14550 --console
```

```bash
# Дрон 4
cd ~/ardupilot/ArduCopter
sim_vehicle.py -v ArduCopter -f gazebo-iris --sysid 4 --instance 3 --out=udp:127.0.0.1:14564 --out=udp:127.0.0.1:14550 --console
```

```bash
# Дрон 5
cd ~/ardupilot/ArduCopter
sim_vehicle.py -v ArduCopter -f gazebo-iris --sysid 5 --instance 4 --out=udp:127.0.0.1:14565 --out=udp:127.0.0.1:14550 --console
```

Дождитесь полной инициализации каждого экземпляра ArduCopter перед запуском следующего.

#### Шаг 4: Запустите MAVROS для подключения к QGC
```bash
roslaunch basic_nav multi_drone_qgc.launch
```

## Подключение QGroundControl

1. Запустите QGroundControl на вашем компьютере
2. QGC должен автоматически подключиться к дронам через UDP порт 14550
   - Если автоподключение не работает, добавьте соединение вручную:
     - Настройки (шестеренка) -> Comm Links -> Add
     - Тип: UDP
     - Порт: 14550
     - Нажмите "Connect"

3. После подключения вы должны увидеть все 5 дронов в списке аппаратов (Vehicle List)
   - Каждый дрон имеет свой системный ID (от 1 до 5)
   - Вы можете переключаться между дронами, выбирая их из списка

## Управление дронами через QGC

Для каждого дрона вы можете:

1. **Армировать и взлетать**:
   - Нажмите кнопку "Arm" для армирования дрона
   - После армирования нажмите "Takeoff" для взлета

2. **Создать и запустить миссию**:
   - Перейдите на вкладку "Plan"
   - Создайте миссию, добавляя точки на карте
   - Загрузите миссию на дрон (Upload)
   - Вернитесь на вкладку "Fly"
   - Запустите миссию кнопкой "Start Mission"

3. **Управлять вручную**:
   - Используйте режим "Guided" для отправки команд перемещения
   - Нажмите на карту и выберите "Go to location" для перемещения дрона в указанную точку

## Устранение неполадок

1. **Проблемы с подключением QGC**:
   - Убедитесь, что UDP порт 14550 доступен и не блокируется фаерволом
   - Проверьте, что все экземпляры SITL запущены с параметром `--out=udp:127.0.0.1:14550`

2. **Дрон не армируется**:
   - Проверьте логи SITL для выявления причины
   - Убедитесь, что дрон находится в режиме "GUIDED"
   - Проверьте, что все необходимые предполетные проверки пройдены

3. **Дрон не следует по маршруту**:
   - Убедитесь, что миссия корректно загружена
   - Проверьте, что дрон находится в режиме "AUTO" для выполнения миссии

4. **Проблемы с Gazebo**:
   - Если модели дронов ведут себя странно, попробуйте перезапустить Gazebo
   - Убедитесь, что модели правильно размещены и не пересекаются друг с другом 